<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Margin Calculator</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.5; }
    input { margin: 5px; padding: 5px; width: 120px; }
    button { margin: 10px 0; padding: 8px 12px; }
    table { border-collapse: collapse; margin-top: 15px; min-width: 400px; }
    table, th, td { border: 1px solid #ccc; padding: 8px 12px; text-align: left; }
    th { background: #f2f2f2; }
  </style>
</head>
<body>

  <h2>Trading Margin Calculator</h2>

  <label>Take Profit (%): <input id="tp" type="number" step="0.01" value="3"></label><br>
  <label>Stop Loss (%): <input id="sl" type="number" step="0.01" value="1.5"></label><br>
  <label>Leverage: <input id="leverage" type="number" value="10"></label><br>
  <label>Maker Fee (%): <input id="feeEntry" type="number" step="0.001" value="0.04"></label><br>
  <label>Taker Fee (%): <input id="feeExit" type="number" step="0.001" value="0.06"></label><br>
  <label>Desired Profit ($): <input id="desiredProfit" type="number"></label><br>
  <label>Desired Loss ($): <input id="maxLoss" type="number"></label><br>

  <button onclick="calculate()">Calculate</button>

  <div id="output"></div>

<script>
function calculate() {
  let tp_pct = parseFloat(document.getElementById("tp").value) / 100;
  let sl_pct = parseFloat(document.getElementById("sl").value) / 100;
  let leverage = parseFloat(document.getElementById("leverage").value);
  let fee_entry = parseFloat(document.getElementById("feeEntry").value) / 100;
  let fee_exit = parseFloat(document.getElementById("feeExit").value) / 100;
  let desiredProfit = parseFloat(document.getElementById("desiredProfit").value);
  let maxLoss = parseFloat(document.getElementById("maxLoss").value);

  let margin = null;
  let notional = null;
  let netProfitTP = null;
  let netLossSL = null;

  if (!isNaN(desiredProfit) && desiredProfit > 0) {
    // solve margin for target profit
    let denom = leverage * (tp_pct - fee_entry - (1 + tp_pct) * fee_exit);
    if (denom > 0) {
      margin = desiredProfit / denom;
    } else {
      document.getElementById("output").innerHTML = "<p>Target profit not achievable with given inputs.</p>";
      return;
    }
  } else if (!isNaN(maxLoss) && maxLoss > 0) {
    // solve margin for max loss
    let denom = leverage * (sl_pct + fee_entry + (1 - sl_pct) * fee_exit);
    if (denom > 0) {
      margin = maxLoss / denom;
    } else {
      document.getElementById("output").innerHTML = "<p>Target loss not achievable with given inputs.</p>";
      return;
    }
  } else {
    document.getElementById("output").innerHTML = "<p>Please enter either Desired Profit or Desired Loss.</p>";
    return;
  }

  notional = margin * leverage;

  // profit & loss values with fees
  let grossProfit = notional * tp_pct;
  let entryFee = notional * fee_entry;
  let exitFeeTP = (notional * (1 + tp_pct)) * fee_exit;
  netProfitTP = grossProfit - entryFee - exitFeeTP;

  let grossLoss = notional * sl_pct;
  let exitFeeSL = (notional * (1 - sl_pct)) * fee_exit;
  netLossSL = grossLoss + entryFee + exitFeeSL;

  let html = `
    <h3>Results</h3>
    <table>
      <tr><th>Required Margin</th><td>$${margin.toFixed(2)}</td></tr>
      <tr><th>Position Notional</th><td>$${notional.toFixed(2)}</td></tr>
      <tr><th>Net Profit at TP</th><td>$${netProfitTP.toFixed(2)}</td></tr>
      <tr><th>Net Loss at SL</th><td>$${netLossSL.toFixed(2)}</td></tr>
    </table>
  `;
  document.getElementById("output").innerHTML = html;
}
</script>

</body>
</html>
